<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sponsor Index Scheduler</title>
</head>
<body>
    <sponsor-scheduler></sponsor-scheduler>
    <script>
        // Our working simplified scheduler code
        class SponsorScheduler extends HTMLElement {
            static get observedAttributes() {
                return ['newsletter'];
            }

            constructor() {
                super();
                this._newsletter = 'direct_access';
                this._formData = {
                    date: "",
                    time: "",
                    time12Hour: "",
                    name: "",
                    email: "",
                    budget: "",
                    campaignGoals: "",
                    urlSlug: this._newsletter
                };
                this._selectedDate = null;
                this._currentMonth = new Date();
            }

            connectedCallback() {
                this.render();
                this.setupEventListeners();
            }

            render() {
                const styles = `
                    <style>
                        .scheduler-container {
                            width: 100%;
                            max-width: 320px;
                            margin: 0 auto;
                            font-family: Arial, sans-serif;
                            background: white;
                            padding: 15px;
                            box-sizing: border-box;
                        }
                        .progress-bar {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 20px;
                            position: relative;
                            padding: 0 15px;
                        }
                        .progress-bar::before {
                            content: '';
                            position: absolute;
                            top: 50%;
                            left: 25px;
                            right: 25px;
                            height: 2px;
                            background-color: #ddd;
                            transform: translateY(-50%);
                            z-index: 1;
                        }
                        .step {
                            width: 24px;
                            height: 24px;
                            border-radius: 50%;
                            background-color: #ddd;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-weight: bold;
                            position: relative;
                            z-index: 2;
                            color: white;
                        }
                        .step.active {
                            background-color: #20B2AA;
                        }
                        .calendar {
                            width: 100%;
                            border: 1px solid #ddd;
                            border-radius: 8px;
                            overflow: hidden;
                            background: white;
                        }
                        .calendar-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 10px;
                            background: #f8f8f8;
                        }
                        .calendar-grid {
                            display: grid;
                            grid-template-columns: repeat(7, 1fr);
                            gap: 1px;
                            background: #f0f0f0;
                        }
                        .calendar-day {
                            aspect-ratio: 1;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            background: white;
                            cursor: pointer;
                            border: none;
                            font-size: 14px;
                        }
                        .calendar-day:hover:not(.disabled) {
                            background: #f0f0f0;
                        }
                        .calendar-day.selected {
                            background: #20B2AA;
                            color: white;
                        }
                        .calendar-day.disabled {
                            color: #ccc;
                            cursor: not-allowed;
                        }
                        .calendar-day.today {
                            font-weight: bold;
                        }
                        .weekday {
                            text-align: center;
                            padding: 5px;
                            font-weight: bold;
                            background: white;
                        }
                        .nav-button {
                            background: none;
                            border: none;
                            cursor: pointer;
                            padding: 5px 10px;
                            font-size: 16px;
                        }
                        .page {
                            display: none;
                        }
                        .page.active {
                            display: block;
                        }
                        .time-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                            gap: 5px;
                            margin: 10px 0;
                        }
                        .time-button {
                            padding: 8px 5px;
                            border: 1px solid #ddd;
                            border-radius: 4px;
                            cursor: pointer;
                            font-size: 12px;
                            text-align: center;
                            background: white;
                        }
                        .time-button.selected {
                            background: #20B2AA;
                            color: white;
                        }
                        .form-group {
                            margin-bottom: 15px;
                        }
                        label {
                            display: block;
                            margin-bottom: 5px;
                            font-weight: bold;
                        }
                        input, textarea {
                            width: 100%;
                            padding: 8px;
                            border: 1px solid #ddd;
                            border-radius: 4px;
                            box-sizing: border-box;
                        }
                        .button-group {
                            display: flex;
                            justify-content: space-between;
                            margin-top: 20px;
                        }
                        button {
                            padding: 8px 16px;
                            border: none;
                            border-radius: 4px;
                            cursor: pointer;
                        }
                        button.next {
                            background: #20B2AA;
                            color: white;
                        }
                        button.prev {
                            background: #6c757d;
                            color: white;
                        }
                        h2 {
                            font-size: 16px;
                            margin-bottom: 15px;
                            color: #333;
                        }
                    </style>
                `;

                this.innerHTML = `
                    ${styles}
                    <div class="scheduler-container">
                        <div class="progress-bar">
                            <div class="step active">1</div>
                            <div class="step">2</div>
                            <div class="step">3</div>
                        </div>

                        <form id="schedulerForm">
                            <div id="page1" class="page active">
                                <h2>Select a Date</h2>
                                <div class="calendar">
                                    <div class="calendar-header">
                                        <button type="button" class="nav-button prev-month">&lt;</button>
                                        <span class="current-month"></span>
                                        <button type="button" class="nav-button next-month">&gt;</button>
                                    </div>
                                    <div class="calendar-grid">
                                        <div class="weekday">Sun</div>
                                        <div class="weekday">Mon</div>
                                        <div class="weekday">Tue</div>
                                        <div class="weekday">Wed</div>
                                        <div class="weekday">Thu</div>
                                        <div class="weekday">Fri</div>
                                        <div class="weekday">Sat</div>
                                    </div>
                                </div>
                                <div class="button-group">
                                    <div></div>
                                    <button type="button" class="next">Next</button>
                                </div>
                            </div>

                            <div id="page2" class="page">
                                <h2>Select a Time</h2>
                                <div id="timeGrid" class="time-grid"></div>
                                <div class="button-group">
                                    <button type="button" class="prev">Previous</button>
                                    <button type="button" class="next">Next</button>
                                </div>
                            </div>

                            <div id="page3" class="page">
                                <h2>Your Information</h2>
                                <div class="form-group">
                                    <label for="name">Name:</label>
                                    <input type="text" id="name" required>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email:</label>
                                    <input type="email" id="email" required>
                                </div>
                                <div class="form-group">
                                    <label for="budget">Budget (USD):</label>
                                    <input type="number" id="budget" required min="0">
                                </div>
                                <div class="form-group">
                                    <label for="campaignGoals">Campaign Goals:</label>
                                    <textarea id="campaignGoals" required></textarea>
                                </div>
                                <div class="button-group">
                                    <button type="button" class="prev">Previous</button>
                                    <button type="submit" class="next">Schedule Call</button>
                                </div>
                            </div>
                        </form>
                    </div>
                `;

                this.renderCalendar();
                this.generateTimeSlots();
            }

            renderCalendar() {
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                    'July', 'August', 'September', 'October', 'November', 'December'];
                
                const currentMonthDisplay = this.querySelector('.current-month');
                currentMonthDisplay.textContent = `${monthNames[this._currentMonth.getMonth()]} ${this._currentMonth.getFullYear()}`;

                const calendarGrid = this.querySelector('.calendar-grid');
                const today = new Date();
                const firstDay = new Date(this._currentMonth.getFullYear(), this._currentMonth.getMonth(), 1);
                const lastDay = new Date(this._currentMonth.getFullYear(), this._currentMonth.getMonth() + 1, 0);

                // Keep weekday headers
                const weekdayHeaders = Array.from(calendarGrid.querySelectorAll('.weekday'));
                calendarGrid.innerHTML = '';
                weekdayHeaders.forEach(header => calendarGrid.appendChild(header));

                // Fill in empty days from previous month
                let firstDayOfWeek = firstDay.getDay();
                for (let i = 0; i < firstDayOfWeek; i++) {
                    const emptyDay = document.createElement('button');
                    emptyDay.className = 'calendar-day disabled';
                    emptyDay.disabled = true;
                    calendarGrid.appendChild(emptyDay);
                }

                // Fill in days of current month
                for (let day = 1; day <= lastDay.getDate(); day++) {
                    const date = new Date(this._currentMonth.getFullYear(), this._currentMonth.getMonth(), day);
                    const dayButton = document.createElement('button');
                    dayButton.type = 'button';
                    dayButton.className = 'calendar-day';
                    dayButton.textContent = day;

                    // Disable weekends and past dates
                    const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                    const isPast = date < new Date().setHours(0,0,0,0);
                    if (isWeekend || isPast) {
                        dayButton.classList.add('disabled');
                        dayButton.disabled = true;
                    } else {
                        dayButton.addEventListener('click', () => this.selectDate(date));
                    }

                    // Highlight today
                    if (date.toDateString() === today.toDateString()) {
                        dayButton.classList.add('today');
                    }

                    // Highlight selected date
                    if (this._selectedDate && date.toDateString() === this._selectedDate.toDateString()) {
                        dayButton.classList.add('selected');
                    }

                    calendarGrid.appendChild(dayButton);
                }
            }

            selectDate(date) {
                this._selectedDate = date;
                this._formData.date = date.toISOString().split('T')[0];
                this.renderCalendar();
            }

            generateTimeSlots() {
                const timeGrid = this.querySelector('#timeGrid');
                const startHour = 9;
                const endHour = 17;

                timeGrid.innerHTML = '';
                for (let hour = startHour; hour < endHour; hour++) {
                    for (let minute = 0; minute < 60; minute += 30) {
                        const hour12 = hour > 12 ? hour - 12 : hour;
                        const ampm = hour >= 12 ? 'PM' : 'AM';
                        const timeString = `${hour12}:${minute.toString().padStart(2, '0')} ${ampm}`;
                        const hour24 = hour.toString().padStart(2, '0');
                        const minute24 = minute.toString().padStart(2, '0');

                        const button = document.createElement('button');
                        button.type = 'button';
                        button.className = 'time-button';
                        button.textContent = timeString;
                        button.dataset.time = `${hour24}:${minute24}`;
                        button.dataset.time12 = timeString;
                        
                        button.addEventListener('click', (e) => {
                            timeGrid.querySelectorAll('.time-button').forEach(btn => {
                                btn.classList.remove('selected');
                            });
                            e.target.classList.add('selected');
                            this._formData.time = e.target.dataset.time;
                            this._formData.time12Hour = e.target.dataset.time12;
                        });

                        timeGrid.appendChild(button);
                    }
                }
            }

            setupEventListeners() {
                // Navigation buttons
                this.querySelector('.prev-month').addEventListener('click', () => {
                    this._currentMonth.setMonth(this._currentMonth.getMonth() - 1);
                    this.renderCalendar();
                });

                this.querySelector('.next-month').addEventListener('click', () => {
                    this._currentMonth.setMonth(this._currentMonth.getMonth() + 1);
                    this.renderCalendar();
                });

                // Form navigation
                const form = this.querySelector('#schedulerForm');
                form.addEventListener('submit', this.handleSubmit.bind(this));

                const nextButtons = this.querySelectorAll('button.next');
                nextButtons.forEach(button => {
                    if (button.type !== 'submit') {
                        button.addEventListener('click', () => {
                            const currentPage = parseInt(button.closest('.page').id.replace('page', ''));
                            this.nextPage(currentPage);
                        });
                    }
                });

                const prevButtons = this.querySelectorAll('button.prev');
                prevButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const currentPage = parseInt(button.closest('.page').id.replace('page', ''));
                        this.previousPage(currentPage);
                    });
                });
            }

            nextPage(currentPage) {
                if (!this.validatePage(currentPage)) return;

                this.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });

                const nextPageElement = this.querySelector(`#page${currentPage + 1}`);
                nextPageElement.classList.add('active');

                this.updateProgress(currentPage + 1);
            }

            previousPage(currentPage) {
                this.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });

                const prevPageElement = this.querySelector(`#page${currentPage - 1}`);
                prevPageElement.classList.add('active');

                this.updateProgress(currentPage - 1);
            }

            updateProgress(currentPage) {
                this.querySelectorAll('.step').forEach((step, index) => {
                    if (index + 1 <= currentPage) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active');
                    }
                });
            }

            validatePage(pageNumber) {
                switch(pageNumber) {
                    case 1:
                        if (!this._formData.date) {
                            alert("Please select a date");
                            return false;
                        }
                        return true;
                    case 2:
                        if (!this._formData.time) {
                            alert("Please select a time");
                            return false;
                        }
                        return true;
                    default:
                        return true;
                }
            }

            async handleSubmit(e) {
                e.preventDefault();

                this._formData.name = this.querySelector('#name').value;
                this._formData.email = this.querySelector('#email').value;
                this._formData.budget = this.querySelector('#budget').value;
                this._formData.campaignGoals = this.querySelector('#campaignGoals').value;

                try {
                    const response = await fetch('https://sponsorindexscheduler-2.onrender.com/api/schedule', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(this._formData)
                    });

                    const result = await response.json();
                    
                    if (result.success) {
                        alert('Appointment scheduled successfully! We will contact you soon.');
                        this.resetForm();
                    } else {
                        throw new Error(result.error || 'Failed to schedule appointment');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('There was an error scheduling your appointment: ' + error.message);
                }
            }

            resetForm() {
                const form = this.querySelector('#schedulerForm');
                form.reset();

                this.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });

                const firstPage = this.querySelector('#page1');
                firstPage.classList.add('active');

                this.updateProgress(1);

                const newsletter = this._formData.urlSlug;
                this._formData = {
                    date: "",
                    time: "",
                    time12Hour: "",
                    name: "",
                    email: "",
                    budget: "",
                    campaignGoals: "",
                    urlSlug: newsletter
                };

                this._selectedDate = null;
                this.renderCalendar();
            }

            attributeChangedCallback(name, oldValue, newValue) {
                if (name === 'newsletter' && oldValue !== newValue) {
                    this._newsletter = newValue || 'direct_access';
                    this._formData.urlSlug = this._newsletter;
                }
            }
        }

        customElements.define('sponsor-scheduler', SponsorScheduler);
    </script>
</body>
</html> 